<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Movie Recommender System</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      padding: 20px; 
      background: #fafafa;
    }
    .container {
      max-width: 600px; 
      margin: auto;
    }
    h2 {
      text-align: center;
    }
    select, button {
      padding: 12px;
      font-size: 16px;
      margin-top: 10px;
      width: 100%;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background: #f0f0f0;
      cursor: pointer;
    }
    button:hover {
      background: #e4e4e4;
    }
    #results {
      margin-top: 25px;
    }
    .movie {
      background: white;
      padding: 12px;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #ddd;
    }
  </style>
</head>

<body>
<div class="container">
  <h2>Movie Recommender</h2>

  <label><b>Select a movie:</b></label>
  <select id="movieSelect"></select>

  <button onclick="recommend()">Recommend</button>

  <div id="results"></div>
</div>

<script>
// ---- LOAD MOVIES.JSON ----
let movies = [];
fetch("movies.json")
  .then(res => res.json())
  .then(data => {
    movies = data;

    const dropdown = document.getElementById("movieSelect");
    movies.forEach((m, i) => {
      const option = document.createElement("option");
      option.value = i;
      option.textContent = m.title;
      dropdown.appendChild(option);
    });
  });

// ---- COSINE SIMILARITY (robust, no NaN) ----
function cosine(a, b) {
  if (!a || !b || a.length !== b.length) return 0;

  let dot = 0, magA = 0, magB = 0;

  for (let i = 0; i < a.length; i++) {
    const x = Number(a[i]) || 0;
    const y = Number(b[i]) || 0;
    dot += x * y;
    magA += x * x;
    magB += y * y;
  }

  if (magA === 0 || magB === 0) return 0;

  const sim = dot / (Math.sqrt(magA) * Math.sqrt(magB));
  if (!isFinite(sim) || isNaN(sim)) return 0;
  return sim;
}

// ---- RECOMMENDATION FUNCTION ----
function recommend() {
  const idx = Number(document.getElementById("movieSelect").value);
  const vec = movies[idx].vector;

  const sims = movies.map((m, i) => ({
    index: i,
    sim: cosine(vec, m.vector)
  }));

  sims.sort((a, b) => b.sim - a.sim);

  const top = sims.slice(1, 6); // skip itself

  let output = `<h3>Recommended Movies:</h3>`;
  top.forEach(t => {
    const score = (!isFinite(t.sim) || isNaN(t.sim)) ? "0.000" : t.sim.toFixed(3);
    output += `
      <div class="movie">
        <b>${movies[t.index].title}</b><br>
        Similarity score: ${score}
      </div>
    `;
  });

  document.getElementById("results").innerHTML = output;
}
</script>

</body>
</html>
